ğŸ§¡Ajax ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½

ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 
resources :pictures do
    resources :comments
  end
ã“ã‚Œã§å†™çœŸæŠ•ç¨¿ã«ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä½œæˆ
ex)new_picture_comment GET /pictures/:picture_id/comments/new(.:format) comments#new

æŠ•ç¨¿ã¨ã‚³ãƒ¡ãƒ³ãƒˆã¯ï¼‘å¯¾å¤š
$ rails g model Comment picture:references content:text
$ rails db:migrate
ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³belongs_to, has_manyã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

$ rails g controller comments create
ä¸è¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‰Šé™¤

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯createã‚¢ã‚¯ã‚·ãƒ§ãƒ³
respond_toãƒ¡ã‚½ãƒƒãƒ‰
HTMLã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯format.htmlï¼ˆlocal: trueï¼‰=> index.html.erbã‚’æ¢ã—ã«ã„ã
JavaScriptã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯format.jsï¼ˆremote: true)ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ => index.js.erbã‚’æ¢ã—ã«ã„ã

æŠ•ç¨¿è©³ç´°ãƒšãƒ¼ã‚¸ç·¨é›†
ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ã¨ã€ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«åŒ–ï¼
pictures_controllerã®showã«ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆã¨ä¸€è¦§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã€è¿½åŠ 

index.js.erb JSå½¢å¼ã®view
blogs/show.html.erbã§id=comments_areaã¨ã§å®šç¾©ã—ãŸdivã®ä¸­ã‚’æ›¸ãæ›ãˆã‚‹jQueryã‚’è¨˜è¿°
ç·¨é›†ã€å‰Šé™¤ã‚‚ä½œã‚‹

ğŸ§¡Ajax ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ä½œã‚‹
$ rails g model relationship follower_id:integer followed_id:integer

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜
  add_index :relationships, :follower_id => Relationshipãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ã¯é »ç¹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã™ã‚‹ã‹ã‚‰ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ã€‚
  add_index :relationships, :followed_id
  add_index :relationships, [:follower_id, :followed_id], unique: true => è¤‡åˆã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/åŒã˜çµ„ã¿åˆã‚ã›ã§ä¿å­˜ã•ã‚Œãªã„ã‚ˆã†ã«

$ rails db:migrate

ãƒ¢ãƒ‡ãƒ«ã«ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³è¿½è¨˜
(app/models/user.rb)
has_many :active_relationships, foreign_key: 'follower_id', class_name: 'Relationship', dependent: :destroy
has_many :passive_relationships, foreign_key: 'followed_id', class_name: 'Relationship', dependent: :destroy
relationshipãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ä»¶å–å¾—
=> Userãƒ¢ãƒ‡ãƒ«ã¯å¤šãã®active_relationships(è‡ªåˆ†ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹äººï¼‰ã‚’æŒã¡ã€ãã‚Œã¯follower_idã«ã‚ˆã£ã¦Relationshipãƒ¢ãƒ‡ãƒ«ã«é–¢é€£ã¥ã‘ã‚‰ã‚Œã‚‹ã€‚
=> Userãƒ¢ãƒ‡ãƒ«ã¯å¤šãã®passive_relationships(è‡ªåˆ†ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ï¼‰ã‚’æŒã¡ã€ãã‚Œã¯followed_idã«ã‚ˆã£ã¦Relationshipãƒ¢ãƒ‡ãƒ«ã«é–¢é€£ã¥ã‘ã‚‰ã‚Œã‚‹ã€‚
class_name: 'Relationship ã§ã€ãƒ¢ãƒ‡ãƒ«æŒ‡å®šã€‚ã—ãªã„ã¨ã€has_namyã®ç›´å¾Œã®ActiveRelationshipãƒ¢ãƒ‡ãƒ«ã‚’æ¢ã—ã¦ã—ã¾ã†

has_many :following, through: :active_relationships, source: :followed
has_many :followers, through: :passive_relationships, source: :follower
relationshipsãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é€šã£ã¦ã€ä»¥ä¸‹ãŒèª°ãªã®ã‹ï¼Ÿã‚’å–å¾—
followingï¼šè‡ªåˆ†ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶
followersï¼šè‡ªåˆ†ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶

(app/models/relationship.rb)
belongs_to :followed, class_name: "User"
belongs_to :follower, class_name: "User"